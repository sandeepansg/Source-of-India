%% Configuration for SoI LaTeX Class v1.1 - Fixed Version
%% This file contains document-wide configuration settings with enhancements

%% Amendment display settings
\showamendmentstrue     % Show amendment footnotes
\showomittedfalse       % Hide omitted articles by default

%% Custom amendment bracket styles (optional)
% \renewcommand{\amendmentopen}{\{}
% \renewcommand{\amendmentclose}{\}}

%% Typography customization with improved spacing
% \renewcommand{\partsize}{\huge}
% \renewcommand{\articlesize}{\large}

%% Enhanced spacing adjustments for better readability
\setlength{\parskip}{0.6em plus 0.1em minus 0.1em}
\setlength{\parindent}{0pt}

%% Improved footnote customization with better spacing
\setlength{\footnotesep}{0.8em}
\setlength{\skip\footins}{1.2em plus 0.4em minus 0.2em}
\renewcommand{\footnotesize}{\small}

%% Enhanced page break preferences
\clubpenalty=10000
\widowpenalty=10000
\raggedbottom

%% Two-sided document enhancements
\geometry{
    twoside,
    bindingoffset=0.5cm,
    inner=3cm,
    outer=2.5cm
}

%% Development mode settings with two-sided support
\makeatletter
\if@draftmode
    % Additional debug information in draft mode
    \AtEndDocument{%
        \clearpage
        \section*{Document Statistics}
        \begin{tabular}{ll}
        Total Articles: & \thetotalarticles \\
        Total Amendments: & \thetotalamendments \\
        Omitted Articles: & \thetotalomitted \\
        Document Pages: & \pageref{LastPage} \\
        Layout: & Two-sided \\
        \end{tabular}
    }
\fi
\makeatother

%% Table of contents depth
\setcounter{tocdepth}{3}

%% Custom colors (requires xcolor package if used)
% \RequirePackage{xcolor}
% \definecolor{amendmentcolor}{rgb}{0,0,0.8}

%% Custom commands for specific constitutional elements
\newcommand{\ArticleRef}[1]{Article~#1}
\newcommand{\PartRef}[1]{Part~#1}
\newcommand{\ScheduleRef}[1]{Schedule~#1}

%% Enhanced amendment citation standards
\newcommand{\ConstitutionAmendment}[3]{%
    Constitution (#1 Amendment) Act, #2, s.~#3%
}

%% Conditional compilation helpers
\newif\ifcompilepart
\newif\ifcompileschedules
\compileparttrue
\compileschedulestrue

%% Memory optimization for large documents
\setcounter{totalnumber}{50}
\setcounter{topnumber}{50}
\setcounter{bottomnumber}{50}
\renewcommand{\topfraction}{0.85}
\renewcommand{\bottomfraction}{0.85}
\renewcommand{\textfraction}{0.15}
\renewcommand{\floatpagefraction}{0.7}

%% Error handling and validation
\newcommand{\ValidateArticleNumber}[1]{%
    \ifnum#1<1\relax
        \ClassError{soi}{Invalid article number: #1}{Article numbers must be positive integers}%
    \fi%
    \ifnum#1>395\relax
        \ClassWarning{soi}{Article number #1 exceeds known range}%
    \fi%
}

%% Cross-reference formatting
\newcommand{\xref}[1]{\hyperref[#1]{#1}}

%% Special formatting for constitutional quotes
\newenvironment{constitutionalquote}
    {\begin{quote}\itshape}
    {\end{quote}}

%% Amendment history tracking (optional)
\newcommand{\AmendmentHistory}[1]{%
    % This could be expanded to track complete amendment history
    % Currently just passes through to standard Amendment command
    \Amendment{#1}%
}

%% Debug mode helpers
\newcommand{\DebugInfo}[1]{%
    \if@draftmode
        \marginpar{\tiny\textcolor{red}{#1}}%
    \fi
}

%% Enhanced page styles for different sections with two-sided support
\RequirePackage{fancyhdr}

\fancypagestyle{partpage}{%
    \fancyhf{}%
    \fancyfoot[C]{\thepage}%
    \renewcommand{\headrulewidth}{0pt}%
}

\fancypagestyle{schedulepage}{%
    \fancyhf{}%
    \fancyhead[LE]{\small\leftmark}%
    \fancyhead[RO]{\small\leftmark}%
    \fancyhead[LO,RE]{\small\itshape Schedules}%
    \fancyfoot[C]{\thepage}%
}

%% Enhanced page management settings
\RequirePackage{needspace}

%% Prevent page breaks within constitutional elements
\newcommand{\keepwithfootnote}[1]{%
    \needspace{4\baselineskip}%
    #1%
}

%% Enhanced footnote management for amendments with improved spacing
\makeatletter
\renewcommand\@makefntext[1]{%
    \parindent 1em%
    \noindent
    \hb@xt@1.8em{\hss\@makefnmark}%
    \raggedright #1%
}
\makeatother

%% Ensure amendments and their footnotes stay together
\newcommand{\amendmentwithfootnote}[2]{%
    \needspace{3\baselineskip}%
    #1\footnote{#2}%
}

%% Enhanced page layout optimization for text-footnote balance
\RequirePackage{geometry}
\geometry{
    footnotesep=0.8em,
    marginparsep=0.5em
}

%% Enhanced list formatting for constitutional elements
\RequirePackage{enumitem}
\setlist{nosep, leftmargin=2em}
\setlist[enumerate,1]{label=(\arabic*)}
\setlist[enumerate,2]{label=(\alph*)}
\setlist[enumerate,3]{label=(\roman*)}

%% Special handling for long constitutional provisions
\newenvironment{longprovision}
    {\par\needspace{4\baselineskip}\begin{adjustwidth}{1em}{1em}\small}
    {\end{adjustwidth}\par}

%% Enhanced amendment tracking
\newcounter{amendmentcount}
\newcommand{\trackamendment}[1]{%
    \stepcounter{amendmentcount}%
    \label{amendment:\theamendmentcount}%
}

%% Ensure proper spacing around constitutional elements
\newcommand{\constitutionalspacing}{%
    \setlength{\parskip}{0.6em plus 0.2em minus 0.1em}%
    \setlength{\itemsep}{0.3em plus 0.1em minus 0.1em}%
}

%% Enhanced section heading management
\newcommand{\sectionheadingspacing}{%
    \setlength{\parskip}{1em plus 0.3em minus 0.2em}%
}

%% Apply constitutional spacing
\AtBeginDocument{\constitutionalspacing}

%% Two-sided layout helpers
\newcommand{\cleardoublepage}{%
    \clearpage
    \if@twoside
        \ifodd\c@page
        \else
            \hbox{}%
            \vspace*{\fill}%
            \begin{center}%
                \textit{[This page intentionally left blank]}%
            \end{center}%
            \vspace{\fill}%
            \thispagestyle{empty}%
            \newpage
        \fi
    \fi
}

%% Enhanced footnote spacing control
\renewcommand{\footnoterule}{%
    \kern-3pt
    \vspace{0.5em}%
    \hrule width 0.4\columnwidth height 0.4pt
    \vspace{0.3em}%
    \kern 2.6pt
}

%% Improved constitutional section command
\renewcommand{\ConstitutionalSection}[1]{%
    \needspace{4\baselineskip}%
    \vspace{1em plus 0.3em minus 0.2em}%
    {\centering\normalsize\bfseries #1\par}%
    \nopagebreak[4]%
    \vspace{0.7em plus 0.2em minus 0.1em}%
}

%% End of configuration